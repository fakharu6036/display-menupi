<!DOCTYPE html>
<html>
<head>
    <title>MENUPI API Test</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
        pre { background: #f5f5f5; padding: 10px; overflow: auto; }
    </style>
</head>
<body>
    <h1>MENUPI API Test</h1>
    <div id="results"></div>
    <script>
        const results = document.getElementById('results');
        
        function addResult(title, data, isError = false) {
            const div = document.createElement('div');
            div.className = 'test ' + (isError ? 'error' : 'success');
            div.innerHTML = `<h3>${title}</h3><pre>${JSON.stringify(data, null, 2)}</pre>`;
            results.appendChild(div);
        }
        
        async function testAPI() {
            // Get token from localStorage
            const userStr = localStorage.getItem('menupi_user');
            if (!userStr) {
                addResult('Error', 'No user found in localStorage. Please login first.', true);
                return;
            }
            
            const user = JSON.parse(userStr);
            const token = user.token;
            
            if (!token) {
                addResult('Error', 'No token found in user data', true);
                return;
            }
            
            addResult('Token Found', { token: token.substring(0, 20) + '...', userId: user.id });
            
            // Test 1: Check headers
            try {
                const headersRes = await fetch('https://api.menupi.com/test-headers.php', {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                const headersData = await headersRes.json();
                addResult('Test Headers', headersData);
            } catch (e) {
                addResult('Test Headers Error', e.message, true);
            }
            
            // Test 2: Health check
            try {
                const healthRes = await fetch('https://api.menupi.com/health');
                const healthData = await healthRes.json();
                addResult('Health Check', healthData);
            } catch (e) {
                addResult('Health Check Error', e.message, true);
            }
            
            // Test 3: Refresh user data
            try {
                const refreshRes = await fetch('https://api.menupi.com/api/users/me/refresh', {
                    headers: { 
                        'Authorization': 'Bearer ' + token,
                        'Content-Type': 'application/json'
                    }
                });
                const refreshData = await refreshRes.json();
                addResult('Refresh User Data', { status: refreshRes.status, data: refreshData }, refreshRes.status !== 200);
            } catch (e) {
                addResult('Refresh User Data Error', e.message, true);
            }
            
            // Test 4: Get screens
            try {
                const screensRes = await fetch('https://api.menupi.com/api/screens', {
                    headers: { 
                        'Authorization': 'Bearer ' + token,
                        'Content-Type': 'application/json'
                    }
                });
                const screensData = await screensRes.json();
                addResult('Get Screens', { status: screensRes.status, data: screensData }, screensRes.status !== 200);
            } catch (e) {
                addResult('Get Screens Error', e.message, true);
            }
        }
        
        testAPI();
    </script>
</body>
</html>

